[Service]
# Worker hardening + isolate runtime constraints.
# Delegate=yes grants the service ownership of its cgroup subtree, allowing
# the warm-fork executor to create per-job child cgroups with memory/PID limits.
Delegate=yes
NoNewPrivileges=no
RestrictSUIDSGID=no
PrivateTmp=yes
ProtectSystem=strict
ReadWritePaths=/opt/ai-deep-dive/judge/data /var/local/lib/isolate
ProtectHome=yes
InaccessiblePaths=/etc/judge /root
ProtectKernelTunables=yes
ProtectKernelModules=yes
ProtectControlGroups=no
ProtectProc=invisible
ProcSubset=pid
LockPersonality=yes
TasksMax=256
MemoryMax=1G
CPUQuota=100%
LimitNOFILE=256
Environment=OMP_NUM_THREADS=1
Environment=MKL_NUM_THREADS=1
Environment=OPENBLAS_NUM_THREADS=1
Environment=NUMEXPR_NUM_THREADS=1
Environment=VECLIB_MAXIMUM_THREADS=1
Environment=PYTORCH_NUM_THREADS=1
