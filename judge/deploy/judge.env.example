JUDGE_REDIS_URL=redis://localhost:6379/0
JUDGE_RESULTS_DB=/opt/ai-deep-dive/judge/data/judge.db
JUDGE_PROBLEMS_ROOT=/opt/ai-deep-dive/judge/problems
JUDGE_TESTS_ROOT=/opt/ai-deep-dive/judge/tests
JUDGE_MAX_OUTPUT_CHARS=2000
JUDGE_JOB_CLAIM_IDLE_MS=30000
JUDGE_JOB_CLAIM_COUNT=10
JUDGE_API_WORKERS=1
JUDGE_LIGHT_WORKERS=2
JUDGE_TORCH_WORKERS=1
# Cleanup: delete done/error jobs older than N days
JUDGE_JOB_RETENTION_DAYS=7
# Submission admission limit per queue stream backlog (0 disables capacity check)
JUDGE_QUEUE_MAXLEN=10000
# Backups: daily snapshot of the SQLite DB
JUDGE_BACKUP_DIR=/opt/ai-deep-dive/judge/data/backups
JUDGE_BACKUP_RETENTION_DAYS=7
# Comma-separated list of allowed origins for browser requests
JUDGE_ALLOWED_ORIGINS="https://aideepdive.dev,https://www.aideepdive.dev,https://learning.h3nok.dev,https://h3nok.dev,https://www.h3nok.dev,http://localhost:3000"
# Isolate sandbox settings
JUDGE_ISOLATE_BIN=/usr/bin/isolate
JUDGE_ISOLATE_USE_CGROUPS=1
JUDGE_ISOLATE_PROCESSES=64
JUDGE_ISOLATE_WALL_TIME_EXTRA_S=2
JUDGE_ISOLATE_TIMEOUT_GRACE_S=5
JUDGE_ISOLATE_FSIZE_KB=1024
JUDGE_PYTHON_BIN=/opt/ai-deep-dive/judge/.venv/bin/python
# Torch execution backend:
# - isolate: current per-job isolate process
# - warm_fork (default): warm torch parent + forked child per job (torch workers only)
# VM deploy scripts enforce CPU-only torch wheels for this profile.
JUDGE_TORCH_EXECUTION_MODE=warm_fork
# Warm-fork safety controls
JUDGE_WARM_FORK_ENABLE_NO_NEW_PRIVS=1
JUDGE_WARM_FORK_ENABLE_SECCOMP=1
JUDGE_WARM_FORK_SECCOMP_FAIL_CLOSED=1
JUDGE_WARM_FORK_CLEAR_ENV=1
JUDGE_WARM_FORK_DENY_FILESYSTEM=1
JUDGE_WARM_FORK_ALLOW_ROOT=0
JUDGE_WARM_FORK_CHILD_NOFILE=64
JUDGE_WARM_FORK_ENABLE_CGROUP=1
# Lifecycle recycle: restart warm parent after N jobs (0 = unlimited)
JUDGE_WARM_FORK_MAX_JOBS=0
# Prometheus multiprocess metrics directory (shared by API + workers)
PROMETHEUS_MULTIPROC_DIR=/var/lib/judge/prometheus-multiproc

# Monitoring alert tuning (optional overrides used by apply-prometheus.sh)
# ALERT_LIGHT_WORKERS=2
# ALERT_TORCH_WORKERS=1
# ALERT_LIGHT_SEC_PER_JOB=0.146
# ALERT_TORCH_SEC_PER_JOB=2.74
# ALERT_CAPACITY_SAFETY=0.8
# ALERT_BACKLOG_WARN_MINUTES=10
# ALERT_BACKLOG_FOR=15m
# ALERT_WORKER_HEALTH_FOR=3m
# ALERT_QUEUE_WAIT_WINDOW=10m
# ALERT_QUEUE_WAIT_P95_WARN_SECONDS=60
# ALERT_QUEUE_WAIT_FOR=15m
# ALERT_QUEUE_WAIT_MIN_STARTS=20
# ALERT_INTERNAL_ERROR_WINDOW_MINUTES=10
# ALERT_INTERNAL_ERROR_RATE_THRESHOLD=0.20
# ALERT_INTERNAL_ERROR_FOR=15m
# ALERT_INTERNAL_ERROR_MIN_COMPLETIONS=20
